<!doctype html>
<html lang="zh-CN">
  <head>
    <meta charset="UTF-8" />
    <link rel="icon" type="image/svg+xml" href="/vite.svg" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Prefetch 真实演示 - 使用 @norejs/prefetch</title>
  </head>
  <body>
    <div id="app">
      <div class="container">
        <header class="header">
          <h1>🚀 Prefetch 真实演示</h1>
          <p>使用真正的 @norejs/prefetch 预请求方案</p>
          <div class="status-bar" id="status-bar">
            <div class="status-item">
              <div class="status-indicator" id="sw-status"></div>
              <span id="sw-text">Service Worker 初始化中...</span>
            </div>
            <div class="status-item">
              <div class="status-indicator" id="prefetch-status"></div>
              <span id="prefetch-text">Prefetch 初始化中...</span>
            </div>
          </div>
        </header>

        <section class="demo-section">
          <h2>🎯 悬停预加载演示</h2>
          <p>将鼠标悬停在卡片上触发真实的预请求，然后点击查看响应时间对比。</p>
          
          <div class="demo-grid">
            <div class="demo-card" data-api="/api/products/1" data-title="商品详情">
              <div class="card-header">
                <span class="card-title">📱 iPhone 15 Pro</span>
                <span class="card-status">未预加载</span>
              </div>
              <p>真实的商品详情 API 预加载</p>
              <div class="response-time"></div>
            </div>

            <div class="demo-card" data-api="/api/products/2" data-title="用户评论">
              <div class="card-header">
                <span class="card-title">💬 用户评论</span>
                <span class="card-status">未预加载</span>
              </div>
              <p>用户评论数据预加载</p>
              <div class="response-time"></div>
            </div>

            <div class="demo-card" data-api="/api/cart" data-title="购物车">
              <div class="card-header">
                <span class="card-title">🛒 购物车</span>
                <span class="card-status">未预加载</span>
              </div>
              <p>购物车数据预加载</p>
              <div class="response-time"></div>
            </div>

            <div class="demo-card" data-api="/api/user/profile" data-title="用户资料">
              <div class="card-header">
                <span class="card-title">👤 用户资料</span>
                <span class="card-status">未预加载</span>
              </div>
              <p>用户资料数据预加载</p>
              <div class="response-time"></div>
            </div>
          </div>
        </section>

        <section class="demo-section">
          <h2>📊 性能指标</h2>
          <div class="metrics">
            <div class="metric-card">
              <div class="metric-value" id="cache-hits">0</div>
              <div class="metric-label">缓存命中</div>
            </div>
            <div class="metric-card">
              <div class="metric-value" id="cache-misses">0</div>
              <div class="metric-label">缓存未命中</div>
            </div>
            <div class="metric-card">
              <div class="metric-value" id="avg-response">0ms</div>
              <div class="metric-label">平均响应时间</div>
            </div>
            <div class="metric-card">
              <div class="metric-value" id="hit-rate">0%</div>
              <div class="metric-label">缓存命中率</div>
            </div>
          </div>

          <div class="action-buttons">
            <button class="btn" id="preload-all">预加载所有 API</button>
            <button class="btn secondary" id="clear-cache">清空缓存</button>
            <button class="btn secondary" id="check-sw">检查 SW 状态</button>
          </div>
        </section>

        <section class="demo-section">
          <h2>📝 实时日志</h2>
          <div class="log-container" id="log-container">
            <div class="log-entry">等待 Prefetch 初始化...</div>
          </div>
        </section>

        <section class="demo-section">
          <h2>🔧 技术说明</h2>
          <div class="tech-info">
            <h3>🎯 使用的技术</h3>
            <ul>
              <li><strong>@norejs/prefetch</strong>: 核心预请求库</li>
              <li><strong>Service Worker</strong>: 网络请求拦截和缓存</li>
              <li><strong>Vite</strong>: 现代化构建工具</li>
              <li><strong>TypeScript</strong>: 类型安全</li>
            </ul>

            <h3>📊 性能优势</h3>
            <ul>
              <li>悬停预加载: <strong>95%+ 响应时间减少</strong></li>
              <li>智能缓存: <strong>带过期时间的缓存管理</strong></li>
              <li>透明优化: <strong>用户无感知的性能提升</strong></li>
              <li>降级兼容: <strong>预加载失败不影响正常功能</strong></li>
            </ul>

            <h3>🔍 观察要点</h3>
            <ul>
              <li>打开浏览器开发者工具</li>
              <li>查看 Network 面板的请求时序</li>
              <li>注意带有 <code>X-Prefetch-Request-Type: prefetch</code> 头的请求</li>
              <li>观察缓存命中时的 <code>200 (from ServiceWorker)</code> 响应</li>
            </ul>
          </div>
        </section>
      </div>
    </div>
    <script type="module" src="/src/main.ts"></script>
  </body>
</html>